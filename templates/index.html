<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <link rel="icon" href="../static/img/favicon.ico">
    <link rel="stylesheet" href="../static/fonts/Caveat/Caveat.css">
    <link rel="stylesheet" href="../static/fonts/Noto_Sans_TC/Noto_Sans_TC.css">
    <title>Web PPT</title>
    <script src="../static/js/jquery-3.6.3.min.js"></script>
    <style>
        :root {
            --background-color: #000000;
            --border-color: #353535;
            --text-color: #FFFFFF;
            --highlight-color: #FF8200;
            --second-color: #0082FF;
        }

        html {
            width: 100%;
            height: 100%;
            user-select: none;
        }

        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0px;
        }

        #pages {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: var(--background-color);
        }

        #pages .page {
            position: absolute;
            top: -100%;
            left: 0px;
            width: 100%;
            height: 100%;
            overflow: hidden;

            color: var(--text-color);
            font-family: "Noto Sans TC", sans-serif;
            background-color: inherit;

            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0%;
            transition: top 1s, opacity 1s;
        }

        #pages .page.display {
            top: 0px;
            opacity: 100%;
        }

        @media (max-aspect-ratio: 1/1) {
            #pages .page {
                flex-direction: column;
            }
        }
    </style>
</head>

<body onhashchange="hash_change()">
    <div id="pages"></div>
    <div id="touch-bar">
        <style>
            #touch-bar {
                position: fixed;
                top: 0px;
                left: 0px;
                display: flex;
                width: 100%;
                height: 100%;
                overflow: hidden;
            }

            #touch-bar .touch-block {
                flex: 2;
            }

            #touch-bar .touch-block:first-of-type {
                flex: 1;
            }

            #touch-bar .touch-block:last-of-type {
                flex: 1;
            }
        </style>
        <div class="touch-block"></div>
        <div class="touch-block"></div>
        <div class="touch-block"></div>
    </div>
</body>
<script>
    function hash_change() {
        let hash = location.hash;
        hash = hash === "" ? "#page-1" : hash;
        let target_id = document.querySelector(hash) == null ? document.querySelector("#pages").firstChild.id : hash.replace("#", "");
        document.querySelectorAll("#pages > .page").forEach((element) => {
            if (element.id <= target_id) {
                element.classList.add("display");
            }
            else {
                element.classList.remove("display");
            }
        })
    }

    function hash_decode() {
        let nowpage = parseInt(location.hash.replace("#page-", ""));
        if (isNaN(nowpage)) {
            nowpage = 1;
        }
        return nowpage;
    }

    function change_page(offset = 0) {
        let nowpage = hash_decode();
        let pages_num = document.querySelector("#pages").childElementCount;
        let next_page = nowpage + offset;
        next_page = next_page > 1 ? next_page : 1;
        next_page = next_page < pages_num ? next_page : pages_num;

        location.hash = `page-${next_page}`;
    }

    function load_next_page(next_index = 1, nowpage = 1) {
        let parent = document.querySelector("#pages");
        let new_page = document.createElement("div");
        let page_id = `page-${next_index}`;

        new_page.id = page_id;
        new_page.classList.add("page");
        if (next_index == nowpage) {
            new_page.classList.add("display");
        }

        parent.appendChild(new_page);

        $(`#${page_id}`).load(`/include-page/${page_id}`, (res, status) => {
            if (status === "error") {
                hash_change();
                parent.removeChild(new_page);
            }
            else {
                load_next_page(next_index + 1, nowpage);
            }
        })
    }

    load_next_page(1, hash_decode());
    document.addEventListener("keydown", (event) => {
        if (event.keyCode === 37) {
            change_page(-1);
        }
        else if (event.keyCode === 39) {
            change_page(1);
        }
    });
    document.querySelector("#touch-bar .touch-block:first-of-type").addEventListener("touchstart", (event)=>{
        event.preventDefault()
        change_page(-1);
    });
    document.querySelector("#touch-bar .touch-block:last-of-type").addEventListener("touchstart", (event)=>{
        event.preventDefault()
        change_page(1);
    });
</script>

</html>